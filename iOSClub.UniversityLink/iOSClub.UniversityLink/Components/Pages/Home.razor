@page "/"
@using global::UniversityLink.DataModels
@using Microsoft.EntityFrameworkCore
@inject IDbContextFactory<LinkContext> DbFactory

<PageTitle>建大Link - 西建大iOS Club</PageTitle>

<Flex Justify="center" Align="center">
    <GridRow Class="block" Gutter="(30, 24)">
        @for (var index = 0; index < Categories.Count; index++)
        {
            var category = Categories[index];
            var i = index != Categories.Count - 1 || Categories.Count % 2 == 0 ? index % 4 is 1 or 2 ? 15 : 9 : 24;
            <GridCol Xs="24" Sm="24" Md="@(index != Categories.Count - 1 || Categories.Count % 2 == 0 ? 12 : 24)" Lg="@i" Xl="@i" Xxl="@i">
                <AppleCard Style="height: 100%">
                    <TitleTemplate>
                        <Flex Gap="10">
                            <IconFont Style="font-size: 40px" Type="@($"icon-{category.Icon}")"/>
                            <Title Level="2">@category.Name</Title>
                        </Flex>
                        <Paragraph Type="secondary">@category.Description</Paragraph>
                    </TitleTemplate>
                    <ContextTemplate>
                        <Flex Gap="small" Wrap="wrap" Style="margin-bottom: 8px;">
                            @foreach (var link in category.Links)
                            {
                                <a href="@link.Url" target="_blank" class="a-btn">
                                    <IconFont Style="font-size: 20px" Type="@($"icon-{link.Icon}")"/>
                                    <span style="color: #000000;font-size: 18px;font-weight: 500;">@link.Name</span>
                                    <div style="color: #00000073;text-align: center" class="desktop-phone-flex">@link.Description</div>
                                </a>
                            }
                        </Flex>
                    </ContextTemplate>
                </AppleCard>
            </GridCol>
        }
    </GridRow>
</Flex>

<Footer Class="Layout-Footer" style="text-align: center;">
    <p class="Layout-Footer-Title">
        Copyright
        <Icon Type="copyright" Theme="outline"/>
        2024 XAUAT iOS Club
    </p>
    <div>
        <Space>
            <Split>
                <Divider Type="DirectionVHType.Vertical"/>
            </Split>
            <ChildContent>
                <SpaceItem Class="desktop-phone-flex">
                    <a href="https://cn.xauat.edu.cn/" target="_blank">西安建筑科技大学</a>
                </SpaceItem>
                <SpaceItem>
                    <a href="https://beian.miit.gov.cn/" target="_blank">备案号 陕ICP备2024031872号</a>
                </SpaceItem>
                <SpaceItem Class="desktop-phone-flex">
                    <a href="https://gitee.com/XAUATiOSClub" target="_blank">我们的Gitee组织</a>
                </SpaceItem>
            </ChildContent>
        </Space>
    </div>
</Footer>

@code
{
    private List<CategoryModel> Categories { get; set; } = [];

    protected override async Task OnInitializedAsync()
    {
        if (Categories.Count != 0) return;
        await using var context = await DbFactory.CreateDbContextAsync();
        Categories = await context.Categories
            .Include(x => x.Links)
            .OrderBy(x => x.Index)
            .ToListAsync();
    }
}

<style>
    .ant-layout {
        background-image: linear-gradient(to bottom right, #ff6b6b, #7171ae, #10bce7);
        overflow: auto;
    }

    .ant-layout-content {
        min-height: 100vh;
    }

    .Layout-Header, .Layout-Footer {
        background: rgba(255, 255, 255, 0.3);
        -webkit-backdrop-filter: blur(20px);
        backdrop-filter: blur(20px);
        box-shadow: inset 0 0 6px rgba(255, 255, 255, 0.3);
        padding-left: 10px;
        padding-right: 10px;
        margin: 10px;
        border-radius: 10px;
    }

    .Layout-Footer-Title {
        color: #f3f5f7;
    }

    .block {
        width: 80%;
        margin-top: 45px;
        margin-bottom: 45px;
    }

    @@media screen and (max-width: 768px) {
        .block {
            width: 90%;
        }
    }
    
    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        background-size: auto;
        background-repeat: no-repeat;
        background-position: initial;
    }

    ::-webkit-scrollbar {
        display: none;
    }
</style>